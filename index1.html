<html>
<head>
	<!--<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>-->
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/zepto/0.6/zepto.min.js"></script>
</head>

<body>
	<div id="actionBox">
		<input id="word1" type="text" value=""/>
		<input id="word2" type="text" value=""/>
		<input id="addBtn" type="button" value="add" onclick="addWord()"/>
		<input id="editBtn" type="button" value="edit" onclick="editWord()"/>
        <input id="deleteBtn" type="button" value="del" onclick="deleteWord()"/>
	</div>

	<div id="content">
		
	</div>
	<hr/>
	<div id="log">
	
	</div>
</body>

    <script type="text/javascript">
        
        log("begin", (new Date()).getTime());

        $(document).ready(function () {

            document.getElementById("word1").focus();

            log("document.ready", (new Date()).getTime());
            setActionMode();
            log("setActionMode", (new Date()).getTime());
            initEvents();
            log("initEvents", (new Date()).getTime());
            writeAll();
            log("writeAll", (new Date()).getTime());
        });
	
        function log(text, time)
        {
            var timeSpan = time - window.lastLogTime;
            $("#log").append("<div>" + text + " - <span style='color:green;'>" + timeSpan + "</span></div>");
            window.lastLogTime = time;
        }

        function initEvents() {
            $("#actionBox #word1").bind("keyup", function(e){
                var found = getLine(getWord1());
                if (found)
                {
                    setActionMode("edit");
                    setWord2(found);
                }
                else
                {
                    setActionMode("add");
                    setWord2("");
                }
            });
        }
	
        function setActionMode(mode)
        {
            switch(mode)
            {
            case "add":
                $("#addBtn").show();
                $("#editBtn").hide();
                $("#deleteBtn").hide();
                break;
			
            case "edit":
                $("#addBtn").hide();
                $("#editBtn").show();
                $("#deleteBtn").show();
                break;

            default:
                $("#addBtn").show();
                $("#editBtn").hide();
                $("#deleteBtn").hide();
                break;
            }
        }
	
        function getWord1()
        {
            return $("#actionBox #word1").val();
        }
	
        function getWord2()
        {
            return $("#actionBox #word2").val();
        }
	
        function setWord2(w2)
        {
            $("#actionBox #word2").val(w2);
        }
	
        function writeAll()
        {
            var list = getAll();
		
            for (i in list)
            {
                writeLine(i, list[i]);
            }
        }

        function getAll()
        {
            var storage = window.localStorage;
            var i;
            var key;
            var value;
            var list = {};
            for (i = 0; i < storage.length; i++)
            {
                key = storage.key(i);
                value = getLine(key);
                list[key] = value;
            }
		
            return list;
        }
	
        function getLine(key)
        {
            var storage = window.localStorage;
		
            return storage.getItem(key);
        }

        function addWord()
        {
            var word1 = getWord1();
            var word2 = getWord2();
		
            writeLine(word1, word2);
            saveLine(word1, word2);
        }
	
        function writeLine(w1, w2)
        {
            $("#content").append(formatLine(w1, w2));
        }	
	
        function editWord()
        {
            var word1 = getWord1();
            var word2 = getWord2();
		
            editLine(word1, word2);
            saveLine(word1, word2);
        }

        function deleteWord() {
            var word1 = getWord1();
            deleteLine(word1);

            window.localStorage.removeItem(word1);
        }

        function deleteLine(w1) {
            $("#content #" + w1).remove();
        }
	
        function editLine(w1, w2)
        {
            $("#content #" + w1).replaceWith(formatLine(w1, w2));
        }
	
        function formatLine(w1, w2)
        {
            return "<div id='" + w1 + "'><span>" + w1 + "</span> - <span style='color:green;'>" + w2 + "</span></div>";
        }
	
        function saveLine(w1, w2)
        {
            window.localStorage.setItem(w1, w2);
        }    

    </script>
</html>